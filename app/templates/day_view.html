{% extends "base_patient.html" %}

{% block body %}

<form method = "POST" action = "/day_view" name = "day">
<h2> {{name}} - Daily Activity Info </h2>
<p> Floors: {{floors}} % up or down from yesterday </p>
<p> Steps: {{steps}}</p>
<p> Distance: {{distance}}</p>
<p> Date: {{stripped_time}}</p>
<p>{{daily_data}}</p>
</form>

<a class="btn" href="{{url_for("days_goals")}}">Today's Goals</a>

<script src="/static/js/d3.min.js"></script>
<script src="/static/js/rickshaw.min.js"></script>
<script src="/static/js/Rickshaw.Graph.Axis.Time.js"></script>
<script src="/static/js/Rickshaw.Graph.Axis.X.js"></script>
<script src="/static/js/Rickshaw.Graph.Axis.Y.js"></script>

<style>
#chart_container {
    position: relative;  /* needed for position absolute to work later */
    padding-bottom: 10px;
}

#day_graph {
    position: relative;
    left: 40px;
}

#y_axis {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 40px;
}

#x_axis {
    position: relative;
    left: 40px;
/*    height: 40px;*/
    bottom: 0px;
}
</style>

<div id="chart_container">
    <div id="y_axis"></div>
    <div id = "day_graph"></div>
    <div id = "x_axis"></div>
</div>

<script>
var dailyData = [
        {% for t in daily_tuples %}
          { x: {{t[0]|safe}}, y: {{t[1]|safe}} },
        {% endfor %}
    ];

var day_graph = new Rickshaw.Graph( {
    element: document.querySelector("#day_graph"),
    width: 600,
    height: 400,
    renderer: 'bar',
    series: [ {
        data: dailyData,
        color: 'steelblue'
    } ]
} );

var format = function(n) {

    var map = {
    {% for t in format_tuples %}
        {{t[0]|safe}}: "{{t[1]|safe}}",
    {% endfor %}
    }
    return map[n];
}

var yAxis = new Rickshaw.Graph.Axis.Y({
    graph: day_graph,
    orientation: 'left',
    tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
    element: document.getElementById('y_axis')
});

var x_ticks = new Rickshaw.Graph.Axis.X( {
    graph: day_graph,
    orientation: 'bottom',
    element: document.getElementById('x_axis'),
    // pixelsPerTick: 100,
    tickFormat: format
} );

var hoverDetail = new Rickshaw.Graph.HoverDetail( {
    graph: day_graph,
    xFormatter: function(x) { return x },
} );

day_graph.render();
</script>

{% endblock %}